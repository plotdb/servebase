(function(){var payment;payment={request:function(arg$){var gateway,url,payload,method,this$=this;gateway=arg$.gateway,url=arg$.url,payload=arg$.payload,method=arg$.method;return servebase.corectx(function(arg$){var core,ref$,url,method;core=arg$.core;if(!url){ref$={dummy:{url:"/ext/pay/gw/dummy/",method:"POST"}}[gateway]||{},url=ref$.url,method=ref$.method}if(!(url&&gateway)){return lderror.reject(1200)}core.loader.on();return this$.prepare({payload:payload,gateway:gateway})["finally"](function(){return core.loader.off()}).then(function(ret){ret==null&&(ret={});this$.open({url:url,method:method||"POST",data:ret.payload});return{slug:ret.slug,state:ret.state,key:ret.key}})})},prepare:function(arg$){var payload,gateway;payload=arg$.payload,gateway=arg$.gateway;return ld$.fetch("/api/pay/sign",{method:"POST"},{json:{gateway:gateway,payload:payload},type:"json"}).then(function(ret){ret==null&&(ret={});return{payload:ret.payload,slug:ret.slug,state:ret.state,key:ret.key}})},open:function(arg$){var url,method,data,form,attrs,k,v,input;url=arg$.url,method=arg$.method,data=arg$.data;form=document.createElement("form");attrs={method:method||"post",action:url,target:"_blank"};for(k in attrs){v=attrs[k];form.setAttribute(k,v)}for(k in data){v=data[k];input=document.createElement("input");input.setAttribute("type","hidden");input.setAttribute("name",k);input.value=v;form.appendChild(input)}document.body.appendChild(form);return form.submit()}};if(typeof module!="undefined"&&module!==null){module.exports=payment}else if(typeof window!="undefined"&&window!==null){window.payment=payment}}).call(this);
